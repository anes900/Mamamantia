<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MAMA MANTIA - PROFESIONALNI SISTEM</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/recharts/umd/Recharts.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getFirestore, collection, doc, onSnapshot, updateDoc, increment, setDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";
        const firebaseConfig = {
            apiKey: "AIzaSyBO2uNMXho4fa7fm7eGbJQIE01l0Buj7TQ",
            authDomain: "mamamantia-73a56.firebaseapp.com",
            projectId: "mamamantia-73a56",
            storageBucket: "mamamantia-73a56.firebasestorage.app",
            messagingSenderId: "126561574117",
            appId: "1:126561574117:web:2e1b8cacafea1d95ca880c"
        };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.fb = { updateDoc, doc, increment, setDoc, onSnapshot, collection };
    </script>
    <style>
        body { margin: 0; font-family: sans-serif; background: #2D1409; color: white; }
        .login-screen { display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; padding: 20px; background: linear-gradient(135deg, #2D1409, #4A2C0A); }
        .card { background: white; color: #2D1409; padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .role-btn { width: 100%; padding: 15px; margin: 5px 0; border: 1px solid #ddd; border-radius: 10px; text-align: left; cursor: pointer; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        .active-role { background: #FFB74D; border-color: #FFB74D; }
        .header { background: #2D1409; padding: 15px; color: #FFB74D; display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #FFB74D; }
        .tab-bar { display: flex; overflow-x: auto; background: #3d1f0a; padding: 10px; gap: 10px; }
        .tab { padding: 10px 20px; border-radius: 8px; border: 1px solid #FFB74D; white-space: nowrap; cursor: pointer; }
        .active-tab { background: #FFB74D; color: #2D1409; font-weight: bold; }
        .main-content { padding: 15px; background: #FAF3EC; color: #2D1409; min-height: 80vh; }
        .item-card { background: white; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .btn { padding: 10px 15px; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; }
        .btn-green { background: #107C41; color: white; }
        .btn-red { background: #D84315; color: white; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;
        const { BarChart, Bar, XAxis, YAxis, Tooltip, ResponsiveContainer } = Recharts;

        const ULOGE = {
            direktor: { label: "Direktor", icon: "ðŸ‘”", lokal: null },
            magacioner: { label: "Magacioner", icon: "ðŸ­", lokal: "proizvodnja" },
            prodavac1: { label: "Prodavac Mama 1", icon: "ðŸª", lokal: "mama1" },
            prodavac2: { label: "Prodavac Mama 2", icon: "ðŸ¬", lokal: "mama2" }
        };

        function App() {
            const [user, setUser] = useState(null);
            const [tab, setTab] = useState("stanje");
            const [podaci, setPodaci] = useState([]);

            useEffect(() => {
                if(!window.db) return;
                const unsub = window.fb.onSnapshot(window.fb.collection(window.db, "inventar"), (snap) => {
                    const d = [];
                    snap.forEach(doc => d.push({id: doc.id, ...doc.data()}));
                    setPodaci(d);
                });
                return unsub;
            }, []);

            const izmeni = async (id, br) => {
                await window.fb.updateDoc(window.fb.doc(window.db, "inventar", id), { kolicina: window.fb.increment(br) });
            };

            if (!user) {
                return (
                    <div className="login-screen">
                        <div className="card">
                            <h2 style={{textAlign:'center'}}>MAMA MANTIA</h2>
                            <p style={{textAlign:'center'}}>Izaberite ulogu za pristup:</p>
                            {Object.entries(ULOGE).map(([k, u]) => (
                                <button key={k} className="role-btn" onClick={() => setUser({id: k, ...u})}>
                                    <span style={{fontSize:'20px'}}>{u.icon}</span> {u.label}
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            const mojiArtikli = user.lokal ? podaci.filter(p => p.lokacija === user.lokal) : podaci;

            return (
                <div>
                    <div className="header">
                        <span>{user.icon} {user.label}</span>
                        <button onClick={() => setUser(null)} style={{background:'none', border:'1px solid #FFB74D', color:'#FFB74D', padding:'5px', borderRadius:'5px'}}>Odjavi se</button>
                    </div>
                    <div className="tab-bar">
                        <div className={`tab ${tab==='stanje'?'active-tab':''}`} onClick={()=>setTab('stanje')}>ðŸ“‹ Stanje</div>
                        {user.id === 'direktor' && <div className={`tab ${tab==='graf'?'active-tab':''}`} onClick={()=>setTab('graf')}>ðŸ“Š Statistika</div>}
                    </div>
                    <div className="main-content">
                        {tab === 'stanje' ? (
                            <div>
                                <h3>Zalihe: {user.lokal ? user.lokal.toUpperCase() : "SVI LOKALI"}</h3>
                                {mojiArtikli.map(p => (
                                    <div className="item-card" key={p.id}>
                                        <div><strong>{p.naziv}</strong><br/><small>{p.lokacija}</small></div>
                                        <div style={{display:'flex', alignItems:'center', gap:'10px'}}>
                                            <button className="btn btn-green" onClick={() => izmeni(p.id, 1)}>+</button>
                                            <span style={{fontWeight:'bold', fontSize:'18px'}}>{p.kolicina}</span>
                                            <button className="btn btn-red" onClick={() => izmeni(p.id, -1)}>-</button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div style={{height:'300px', width:'100%'}}>
                                <h3>Pregled zaliha po lokalima</h3>
                                <ResponsiveContainer width="100%" height="100%">
                                    <BarChart data={podaci}>
                                        <XAxis dataKey="naziv" hide />
                                        <YAxis />
                                        <Tooltip />
                                        <Bar dataKey="kolicina" fill="#2D1409" />
                                    </BarChart>
                                </ResponsiveContainer>
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
